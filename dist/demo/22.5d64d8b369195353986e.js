(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"3wwd":function(e,t,n){"use strict";n.r(t),n.d(t,"NewTicketModule",(function(){return ve}));var i=n("tyNb"),o=n("ofXK"),a=n("3Pt+"),c=n("OsiS"),r=n("ZAI4"),s=n("Wcq6"),d=(n("5x/H"),n("Zs65"),n("x4++")),b=(n("FlOX"),n("e1J8"),n("4WDQ")),l=n("WONP"),u=n("QebF"),m=n("P9ut"),f=n("fXoL"),p=n("tk/3"),g=n("kmnG"),h=n("d3UM"),v=n("qFsG"),y=n("bTqV"),U=n("FKr1"),V=n("EVdn"),C=n("PSD3"),w=n.n(C),M=n("1kSV"),_=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function c(e){try{s(i.next(e))}catch(t){a(t)}}function r(e){try{s(i.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}s((i=i.apply(e,t||[])).next())}))},S=function(e,t){var n,i,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function r(a){return function(r){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,i=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=t.call(e,c)}catch(r){a=[6,r],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,r])}}};function k(e,t){if(1&e){var n=f.Wb();f.Vb(0,"li"),f.Vb(1,"a",14),f.fc("click",(function(){f.Bc(n);var e=t.$implicit;return f.jc(2).displayJobsByStatus(e.name)})),f.Mc(2),f.Ub(),f.Ub()}if(2&e){var i=t.$implicit;f.Cb(2),f.Nc(i.name)}}function T(e,t){if(1&e){var n=f.Wb();f.Vb(0,"a",27),f.fc("click",(function(){f.Bc(n);var e=f.jc().$implicit;return f.jc(2).deleteJob(e)})),f.Vb(1,"i",8),f.Mc(2,"close"),f.Ub(),f.Ub()}}function j(e,t){if(1&e){var n=f.Wb();f.Vb(0,"tr"),f.Vb(1,"td"),f.Mc(2),f.Ub(),f.Vb(3,"td"),f.Mc(4),f.Ub(),f.Vb(5,"td"),f.Mc(6),f.Ub(),f.Qb(7,"td",22),f.Vb(8,"td"),f.Qb(9,"div",23),f.Mc(10),f.Ub(),f.Vb(11,"td"),f.Mc(12),f.Ub(),f.Vb(13,"td"),f.Mc(14),f.Ub(),f.Vb(15,"td"),f.Mc(16),f.Ub(),f.Vb(17,"td",21),f.Vb(18,"a",24),f.fc("click",(function(){f.Bc(n);var e=t.$implicit;return f.jc(2).reassignJob(e)})),f.Vb(19,"i",8),f.Mc(20,"refresh"),f.Ub(),f.Ub(),f.Vb(21,"a",25),f.fc("click",(function(){f.Bc(n);var e=t.$implicit;return f.jc(2).editJob(e)})),f.Vb(22,"i",8),f.Mc(23,"edit"),f.Ub(),f.Ub(),f.Kc(24,T,3,0,"a",26),f.Ub(),f.Ub()}if(2&e){var i=t.$implicit,o=f.jc(2);f.Cb(2),f.Nc(i[10]),f.Cb(2),f.Nc(i[1]),f.Cb(2),f.Nc(i[2]),f.Cb(1),f.pc("innerHTML",i[8],f.Cc),f.Cb(2),f.pc("ngStyle",o.getStyle(i[4])),f.Cb(1),f.Oc(" ",i[4]," "),f.Cb(2),f.Nc(i[5]),f.Cb(2),f.Nc(i[6]),f.Cb(2),f.Nc(i[7]),f.Cb(8),f.pc("ngIf","Administrator"===o.role||"SubAdmin"===o.role)}}function I(e,t){if(1&e){var n=f.Wb();f.Vb(0,"div",3),f.Vb(1,"div",4),f.Vb(2,"div",5),f.Vb(3,"div",6),f.Vb(4,"div",7),f.Vb(5,"i",8),f.Mc(6,"assignment"),f.Ub(),f.Ub(),f.Vb(7,"h4",9),f.Mc(8,"Jobs"),f.Ub(),f.Vb(9,"div",10),f.Vb(10,"button",11),f.Vb(11,"i",8),f.Mc(12,"build"),f.Ub(),f.Vb(13,"span",12),f.Mc(14,"Toggle Job Status"),f.Ub(),f.Ub(),f.Vb(15,"ul",13),f.Vb(16,"li"),f.Vb(17,"a",14),f.fc("click",(function(){return f.Bc(n),f.jc().displayJobsByStatus("All")})),f.Mc(18,"All"),f.Ub(),f.Ub(),f.Kc(19,k,3,1,"li",15),f.Ub(),f.Ub(),f.Ub(),f.Vb(20,"div",16),f.Qb(21,"div",17),f.Vb(22,"div",18),f.Vb(23,"table",19),f.Vb(24,"thead"),f.Vb(25,"tr"),f.Vb(26,"th"),f.Mc(27),f.Ub(),f.Vb(28,"th"),f.Mc(29),f.Ub(),f.Vb(30,"th"),f.Mc(31),f.Ub(),f.Vb(32,"th"),f.Mc(33),f.Ub(),f.Vb(34,"th"),f.Mc(35),f.Ub(),f.Vb(36,"th"),f.Mc(37),f.Ub(),f.Vb(38,"th"),f.Mc(39),f.Ub(),f.Vb(40,"th"),f.Mc(41),f.Ub(),f.Vb(42,"th",20),f.Mc(43),f.Ub(),f.Ub(),f.Ub(),f.Vb(44,"tfoot"),f.Vb(45,"tr"),f.Vb(46,"th"),f.Mc(47),f.Ub(),f.Vb(48,"th"),f.Mc(49),f.Ub(),f.Vb(50,"th"),f.Mc(51),f.Ub(),f.Vb(52,"th"),f.Mc(53),f.Ub(),f.Vb(54,"th"),f.Mc(55),f.Ub(),f.Vb(56,"th"),f.Mc(57),f.Ub(),f.Vb(58,"th"),f.Mc(59),f.Ub(),f.Vb(60,"th"),f.Mc(61),f.Ub(),f.Vb(62,"th",21),f.Mc(63),f.Ub(),f.Ub(),f.Ub(),f.Vb(64,"tbody"),f.Kc(65,j,25,10,"tr",15),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub()}if(2&e){var i=f.jc();f.Cb(19),f.pc("ngForOf",i.statuses),f.Cb(8),f.Nc(i.dataTable.headerRow[8]),f.Cb(2),f.Nc(i.dataTable.headerRow[0]),f.Cb(2),f.Nc(i.dataTable.headerRow[1]),f.Cb(2),f.Nc(i.dataTable.headerRow[2]),f.Cb(2),f.Nc(i.dataTable.headerRow[3]),f.Cb(2),f.Nc(i.dataTable.headerRow[4]),f.Cb(2),f.Nc(i.dataTable.headerRow[5]),f.Cb(2),f.Nc(i.dataTable.headerRow[6]),f.Cb(2),f.Oc(" ",i.dataTable.headerRow[7]," "),f.Cb(4),f.Nc(i.dataTable.footerRow[8]),f.Cb(2),f.Nc(i.dataTable.footerRow[0]),f.Cb(2),f.Nc(i.dataTable.footerRow[1]),f.Cb(2),f.Nc(i.dataTable.footerRow[2]),f.Cb(2),f.Nc(i.dataTable.footerRow[3]),f.Cb(2),f.Nc(i.dataTable.footerRow[4]),f.Cb(2),f.Nc(i.dataTable.footerRow[5]),f.Cb(2),f.Nc(i.dataTable.footerRow[6]),f.Cb(2),f.Nc(i.dataTable.footerRow[7]),f.Cb(2),f.pc("ngForOf",i.dataTable.dataRows)}}function A(e,t){if(1&e){var n=f.Wb();f.Vb(0,"li"),f.Vb(1,"a",14),f.fc("click",(function(){f.Bc(n);var e=t.$implicit;return f.jc(3).updateStatus(e.name)})),f.Mc(2),f.Ub(),f.Ub()}if(2&e){var i=t.$implicit;f.Cb(2),f.Nc(i.name)}}var N=function(e){return{color:e}};function B(e,t){if(1&e){var n=f.Wb();f.Vb(0,"div",4),f.Vb(1,"button",33),f.fc("click",(function(){return f.Bc(n),f.jc(2).cancelViewJob()})),f.Mc(2," Cancel "),f.Ub(),f.Vb(3,"ul",34),f.Vb(4,"li",35),f.Vb(5,"div",36),f.Vb(6,"i",8),f.Mc(7,"work"),f.Ub(),f.Ub(),f.Vb(8,"div",37),f.Vb(9,"div",38),f.Vb(10,"span",39),f.Mc(11,"JOB REQUEST"),f.Ub(),f.Ub(),f.Vb(12,"div",40),f.Vb(13,"p"),f.Mc(14," Comment: "),f.Qb(15,"br"),f.Vb(16,"strong"),f.Mc(17),f.Ub(),f.Ub(),f.Qb(18,"br"),f.Vb(19,"p",41),f.Mc(20," Status: "),f.Qb(21,"br"),f.Vb(22,"strong"),f.Mc(23),f.Ub(),f.Ub(),f.Qb(24,"br"),f.Vb(25,"p"),f.Mc(26,"Request:"),f.Ub(),f.Qb(27,"div",22),f.Qb(28,"hr"),f.Vb(29,"div",10),f.Vb(30,"button",11),f.Vb(31,"i",8),f.Mc(32,"build"),f.Ub(),f.Vb(33,"span",12),f.Mc(34,"Update Job Status"),f.Ub(),f.Ub(),f.Vb(35,"ul",13),f.Kc(36,A,3,1,"li",15),f.Ub(),f.Ub(),f.Vb(37,"div",42),f.Vb(38,"button",43),f.fc("click",(function(){f.Bc(n);var e=f.jc(2);return e.reassignJob([e.selectedJob.id,"","",e.selectedJob.customer.email])})),f.Mc(39," Re-Assign Job "),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(40,"li",35),f.Vb(41,"div",44),f.Vb(42,"i",8),f.Mc(43,"handyman"),f.Ub(),f.Ub(),f.Vb(44,"div",37),f.Vb(45,"div",38),f.Vb(46,"span",45),f.Mc(47,"TECHNICIAN INFO"),f.Ub(),f.Ub(),f.Vb(48,"div",40),f.Vb(49,"div",46),f.Vb(50,"div",47),f.Vb(51,"div",48),f.Vb(52,"a",49),f.Qb(53,"img",50),f.Ub(),f.Ub(),f.Vb(54,"div",16),f.Vb(55,"h6",51),f.Mc(56),f.Ub(),f.Vb(57,"h4",9),f.Mc(58),f.Ub(),f.Vb(59,"p",52),f.Mc(60),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(61,"h6"),f.Qb(62,"i",53),f.Mc(63),f.Ub(),f.Ub(),f.Ub(),f.Vb(64,"li",35),f.Vb(65,"div",54),f.Vb(66,"i",8),f.Mc(67,"people"),f.Ub(),f.Ub(),f.Vb(68,"div",37),f.Vb(69,"div",38),f.Vb(70,"span",55),f.Mc(71,"CUSTOMER INFO"),f.Ub(),f.Ub(),f.Vb(72,"div",40),f.Vb(73,"div",46),f.Vb(74,"div",47),f.Vb(75,"div",48),f.Vb(76,"a",49),f.Qb(77,"img",56),f.Ub(),f.Ub(),f.Vb(78,"div",16),f.Vb(79,"h6",51),f.Mc(80),f.Ub(),f.Vb(81,"h4",9),f.Mc(82),f.Ub(),f.Vb(83,"p",52),f.Mc(84),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(85,"h6"),f.Qb(86,"i",53),f.Mc(87),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Qb(88,"br"),f.Vb(89,"button",33),f.fc("click",(function(){return f.Bc(n),f.jc(2).cancelViewJob()})),f.Mc(90," Cancel "),f.Ub(),f.Ub()}if(2&e){var i=f.jc(2);f.Cb(17),f.Nc(i.selectedJob.note),f.Cb(2),f.pc("ngStyle",f.tc(15,N,i.getStatusColorByName(i.selectedJob.status))),f.Cb(4),f.Nc(i.selectedJob.status),f.Cb(4),f.pc("innerHTML",i.displayHTMLCategories(i.selectedJob.category),f.Cc),f.Cb(9),f.pc("ngForOf",i.statuses),f.Cb(17),f.qc("src",i.selectedJob.assigned_to.image,f.Dc),f.Cb(3),f.Oc(" ",i.selectedJob.assigned_to.email," "),f.Cb(2),f.Oc(" ",i.selectedJob.assigned_to.phone," "),f.Cb(2),f.Oc(" ",i.selectedJob.assigned_to.address," "),f.Cb(3),f.Pc(" ",i.selectedJob.assigned_to.name," - ",i.selectedJob.assigned_to.status," "),f.Cb(17),f.Oc(" ",i.selectedJob.customer.email," "),f.Cb(2),f.Oc(" ",i.selectedJob.customer.phone," "),f.Cb(2),f.Oc(" ",i.selectedJob.customer.address," "),f.Cb(3),f.Oc(" ",i.selectedJob.customer.name,"")}}function J(e,t){if(1&e&&(f.Vb(0,"tr"),f.Vb(1,"td"),f.Mc(2),f.Ub(),f.Vb(3,"td"),f.Mc(4),f.Ub(),f.Vb(5,"td"),f.Mc(6),f.Ub(),f.Vb(7,"td"),f.Mc(8),f.Ub(),f.Ub()),2&e){var n=t.$implicit,i=t.index;f.Cb(2),f.Nc(i+1),f.Cb(2),f.Nc(n.comment),f.Cb(2),f.Nc(n.action),f.Cb(2),f.Nc(n.created_date)}}function E(e,t){if(1&e&&(f.Vb(0,"div",4),f.Vb(1,"div",16),f.Qb(2,"div",17),f.Vb(3,"div",18),f.Vb(4,"table",57),f.Vb(5,"thead"),f.Vb(6,"tr"),f.Vb(7,"th"),f.Mc(8,"ID"),f.Ub(),f.Vb(9,"th"),f.Mc(10,"COMMENT"),f.Ub(),f.Vb(11,"th"),f.Mc(12,"REASONS"),f.Ub(),f.Vb(13,"th"),f.Mc(14,"CREATED DATE"),f.Ub(),f.Ub(),f.Ub(),f.Vb(15,"tfoot"),f.Vb(16,"tr"),f.Vb(17,"th"),f.Mc(18,"ID"),f.Ub(),f.Vb(19,"th"),f.Mc(20,"COMMENT"),f.Ub(),f.Vb(21,"th"),f.Mc(22,"REASONS"),f.Ub(),f.Vb(23,"th"),f.Mc(24,"CREATED DATE"),f.Ub(),f.Ub(),f.Ub(),f.Vb(25,"tbody"),f.Kc(26,J,9,4,"tr",15),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub()),2&e){var n=f.jc(2);f.Cb(26),f.pc("ngForOf",n.activities)}}function O(e,t){1&e&&(f.Vb(0,"div",3),f.Vb(1,"div",28),f.Vb(2,"ngb-tabset",29),f.Vb(3,"ngb-tab",30),f.Kc(4,B,91,17,"ng-template",31),f.Ub(),f.Vb(5,"ngb-tab",32),f.Kc(6,E,27,1,"ng-template",31),f.Ub(),f.Ub(),f.Ub(),f.Ub()),2&e&&(f.Cb(2),f.pc("justify","center"))}var L=function(){function e(){this.cusEmail="",this.data=[],this.jobs=[],this.statuses=[],this.categories=[],this.activities=[],this.viewJob=!1,this.config=new b.a,this.button_pressed=!1,this.service=new m.a,this.role=""}return e.prototype.getJobByStatus=function(e){var t=this;(""===this.cusEmail?s.firestore().collection("jobs").where("status","==",e).orderBy("timestamp","desc"):s.firestore().collection("jobs").where("status","==",e).where("customer.email","==",this.cusEmail).orderBy("timestamp","desc")).onSnapshot((function(e){t.data=[],t.jobs=[],e.forEach((function(e){var n=e.data();t.jobs.push(n),t.data.push([n.id,n.assigned_to.name,n.customer.name,n.customer.email,n.status,n.created_by,n.created_date,n.modified_date,t.displayHTMLCategories(n.category),"btn-link",""+n.job_id])})),t.dataTable={headerRow:["Assigned To","Customer","Job Request","Status","Created By","Created Date","Modified Date","Actions","ID"],footerRow:["Assigned To","Customer","Job Request","Status","Created By","Created Date","Modified Date","Actions","ID"],dataRows:t.data}}))},e.prototype.displayJobsByStatus=function(e){"All"!==e?this.getJobByStatus(e):this.getJob()},e.prototype.getJob=function(){var e=this;(""===this.cusEmail?s.firestore().collection("jobs").orderBy("timestamp","desc"):s.firestore().collection("jobs").where("customer.email","==",this.cusEmail).orderBy("timestamp","desc")).onSnapshot((function(t){e.data=[],e.jobs=[],t.forEach((function(t){var n=t.data();e.jobs.push(n),e.data.push([n.id,n.assigned_to.name,n.customer.name,n.customer.email,n.status,n.created_by,n.created_date,n.modified_date,e.displayHTMLCategories(n.category),"btn-link",""+n.job_id])})),e.dataTable={headerRow:["Assigned To","Customer","Skill-Set","Status","Created By","Created Date","Modified Date","Actions","ID"],footerRow:["Assigned To","Customer","Skill-Set","Status","Created By","Created Date","Modified Date","Actions","ID"],dataRows:e.data}}))},Object.defineProperty(e.prototype,"totalRows",{get:function(){return this.getJob.length},enumerable:!1,configurable:!0}),e.prototype.getStatus=function(){var e=this;s.firestore().collection("status").orderBy("name","asc").get().then((function(t){e.statuses=[],t.forEach((function(t){var n=t.data();e.statuses.push(n)})),e.getCategories()}))},e.prototype.getStatusColorByName=function(e){return this.statuses.find((function(t,n,i){return t.name===e})).color},e.prototype.getCategories=function(){var e=this;s.firestore().collection("categories").orderBy("name","desc").onSnapshot((function(t){if(e.categories=[],t.forEach((function(t){var n=t.data();e.categories.push(n)})),""===location.search)e.getJob();else{var n=location.search.substring(3).replace("%20"," ");e.getJobByStatus(n)}}))},e.prototype.getStyle=function(e){return{background:""+this.getStatusColorByName(e),width:"20px",height:"20px","border-radius":"10px"}},e.prototype.ngOnInit=function(){var e=this,t=localStorage.getItem("email");this.service.getUserData(t).then((function(t){e.role=t.role,e.getStatus()}))},e.prototype.getCategoryNameById=function(e){return this.categories.find((function(t,n,i){return t.id===e})).name},e.prototype.displayHTMLCategories=function(e){var t=this,n="<ul>";return e.forEach((function(e){var i=t.getCategoryNameById(e);n+=void 0===i?"":"<li><strong>"+i+"</strong></li>"})),n+="</ul>"},e.prototype.editJob=function(e){this.selectedJob=this.jobs.find((function(t,n,i){return t.id===e[0]})),this.viewJob=!0,this.getJobActivities()},e.prototype.getJobActivities=function(){var e=this;s.firestore().collection("jobs").doc(this.selectedJob.id).collection("activities").orderBy("timestamp","desc").onSnapshot((function(t){e.activities=[],t.forEach((function(t){var n=t.data();e.activities.push(n)}))}))},e.prototype.cancelViewJob=function(){this.viewJob=!1,this.selectedJob=null},e.prototype.deleteJob=function(e){var t=this,n=e[0];w()({title:"Delete Alert",text:"Are you sure about deleting this job?",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1}).then((function(e){e.value?s.firestore().collection("jobs").doc(n).delete().then((function(e){var n=localStorage.getItem("email"),i=localStorage.getItem("name");t.config.logActivity(i+"|"+n+" deleted a job"),t.config.displayMessage("Successfully deleted",!0)})).catch((function(e){t.config.displayMessage(""+e,!1)})):w()({title:"Cancelled",text:"Deletion not successful",type:"error",confirmButtonClass:"btn btn-info",buttonsStyling:!1}).catch(w.a.noop)}))},e.prototype.updateStatus=function(e){var t=this,n=localStorage.getItem("email"),i=localStorage.getItem("name");s.firestore().collection("jobs").doc(this.selectedJob.id).update({status:e}).then((function(o){return _(t,void 0,void 0,(function(){var t,o,a=this;return S(this,(function(c){switch(c.label){case 0:return document.getElementById("stat").innerHTML="Status: <br><strong>"+e+"</strong>",[4,this.backEndJobUpdate(e)];case 1:return c.sent(),t=s.database().ref().push().key,o={id:t,comment:"This job status was changed to : "+e,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()},s.firestore().collection("jobs").doc(this.selectedJob.id).collection("activities").doc(t).set(o).then((function(t){a.config.logActivity(i+"|"+n+" updated job status to : "+e),a.config.displayMessage("Status updated successfully",!0)})).catch((function(e){a.config.displayMessage(""+e,!1)})),[2]}}))}))})).catch((function(e){t.config.displayMessage(""+e,!1)}))},e.prototype.reassignJob=function(e){location.href="/new-ticket?customer="+e[3]+"&jobid="+e[0]},e.prototype.backEndJobUpdate=function(e){return _(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return t=localStorage.getItem("email"),[4,s.firestore().collection("jobs").doc(this.selectedJob.id).update({back_end_status:"completed"===e.toLowerCase()||"canceled"===e.toLowerCase()||"cancelled"===e.toLowerCase()?"inactive":"active"})];case 1:return n.sent(),"completed"!==e.toLowerCase()&&"canceled"!==e.toLowerCase()&&"cancelled"!==e.toLowerCase()||this.config.updateTechnicianStatus(t,"online"),[2]}}))}))},e.prototype.ngAfterViewInit=function(){V("#datatables").DataTable({pagingType:"full_numbers",lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],responsive:!0,language:{search:"_INPUT_",searchPlaceholder:"Search records"}}),V("#datatables").DataTable(),V(".card .material-datatables label").addClass("form-group")},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=f.Jb({type:e,selectors:[["ticket-add-job"]],inputs:{cusEmail:"cusEmail"},decls:4,vars:2,consts:[[1,"main-content"],[1,"container-fluid"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-primary","card-header-icon"],[1,"card-icon"],[1,"material-icons"],[1,"card-title"],[1,"dropdown","pull-left"],["mat-raised-button","","type","button","data-toggle","dropdown",1,"btn","btn-round","btn-info","dropdown-toggle"],[1,"caret"],["role","menu",1,"dropdown-menu","dropdown-menu-right"],["href","javascript:void(0)",3,"click"],[4,"ngFor","ngForOf"],[1,"card-body"],[1,"toolbar"],[1,"material-datatables"],["id","datatables","cellspacing","0","width","100%",1,"table","table-striped","table-no-bordered","table-hover",2,"width","100%"],[1,"disabled-sorting","text-right"],[1,"text-right"],[3,"innerHTML"],[3,"ngStyle"],["href","javascript:void(0)","data-toggle","tooltip","title","re-assign job","data-placement","bottom",1,"btn","btn-link","btn-warning","btn-just-icon","refresh",3,"click"],["href","javascript:void(0)","data-toggle","tooltip","title","edit","data-placement","bottom",1,"btn","btn-link","btn-warning","btn-just-icon","edit",3,"click"],["data-toggle","tooltip","title","delete","data-placement","bottom","href","javascript:void(0)","class","btn btn-link btn-danger btn-just-icon remove",3,"click",4,"ngIf"],["data-toggle","tooltip","title","delete","data-placement","bottom","href","javascript:void(0)",1,"btn","btn-link","btn-danger","btn-just-icon","remove",3,"click"],[1,"col-lg-12"],["type","pills",1,"custom-tab-content","flex-column","flex-md-row",3,"justify"],["title","INFORMATION"],["ngbTabContent",""],["title","ACTIVITIES"],["mat-raised-button","","type","button",1,"btn","btn-round","btn-danger",3,"click"],[1,"timeline","timeline-simple"],[1,"timeline-inverted"],[1,"timeline-badge","info"],[1,"timeline-panel"],[1,"timeline-heading"],[1,"badge","badge-info"],[1,"timeline-body"],["id","stat",3,"ngStyle"],[1,"dropdown","pull-right"],["mat-raised-button","","type","button",1,"btn","btn-round","btn-primary",3,"click"],[1,"timeline-badge","success"],[1,"badge","badge-success"],[1,"col-md-4"],[1,"card","card-profile"],[1,"card-avatar"],["href","javascript:void(0)"],[1,"img",3,"src"],[1,"card-category","text-gray"],[1,"card-description"],[1,"ti-time"],[1,"timeline-badge","danger"],[1,"badge","badge-danger"],["src","assets/img/default-avatar.png",1,"img"],["id","datatables2","cellspacing","0","width","100%",1,"table","table-striped","table-no-bordered","table-hover",2,"width","100%"]],template:function(e,t){1&e&&(f.Vb(0,"div",0),f.Vb(1,"div",1),f.Kc(2,I,66,20,"div",2),f.Kc(3,O,7,1,"div",2),f.Ub(),f.Ub()),2&e&&(f.Cb(2),f.pc("ngIf",!t.viewJob),f.Cb(1),f.pc("ngIf",t.viewJob))},directives:[o.m,y.b,o.l,o.n,M.e,M.c,M.d],styles:[""]}),e}(),P=n("JX91"),R=n("lJxs"),D=n("/1cH");function x(e,t){if(1&e&&(f.Vb(0,"mat-option",14),f.Mc(1),f.Ub()),2&e){var n=t.$implicit;f.pc("value",n.email),f.Cb(1),f.Oc(" ",n.name," ")}}var Q=function(){function e(){this.customers=[],this.myControl=new a.g,this._onCustomerSelect=new f.o,this._AddCus=new f.o}return e.prototype.ngOnInit=function(){this.getCustomers()},e.prototype.getCustomers=function(){var e=this;s.firestore().collection("customers").orderBy("name","asc").get().then((function(t){e.customers=[],t.forEach((function(t){var n=t.data();e.customers.push(n)})),e.filteredOptions=e.myControl.valueChanges.pipe(Object(P.a)(""),Object(R.a)((function(t){return e._filter(t)})))}))},e.prototype._filter=function(e){var t=e.toLowerCase();return this.customers.filter((function(e){return e.name.toLowerCase().includes(t)}))},e.prototype.onCustomerSelect=function(e){this.myControl.setValue(""),this._onCustomerSelect.emit(e)},e.prototype.AddCus=function(){this._AddCus.emit(!0)},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=f.Jb({type:e,selectors:[["app-search-customer"]],outputs:{_onCustomerSelect:"_onCustomerSelect",_AddCus:"_AddCus"},decls:18,vars:5,consts:[[1,"card"],[1,"card-header","card-header-rose","card-header-icon"],[1,"card-icon"],[1,"material-icons"],[1,"card-title"],[1,"card-body"],["method","#","action","#"],[1,"example-full-width"],["type","text","placeholder","Enter Customer Name","aria-label","Name","matInput","",3,"formControl","matAutocomplete"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"card-footer"],["mat-raised-button","","type","submit",1,"btn","btn-fill","btn-rose",3,"click"],[3,"value"]],template:function(e,t){if(1&e&&(f.Vb(0,"div",0),f.Vb(1,"div",1),f.Vb(2,"div",2),f.Vb(3,"i",3),f.Mc(4,"search"),f.Ub(),f.Ub(),f.Vb(5,"h4",4),f.Mc(6,"Search For Customer"),f.Ub(),f.Ub(),f.Vb(7,"div",5),f.Vb(8,"form",6),f.Vb(9,"mat-form-field",7),f.Qb(10,"input",8),f.Vb(11,"mat-autocomplete",9,10),f.fc("optionSelected",(function(e){return t.onCustomerSelect(e)})),f.Kc(13,x,2,2,"mat-option",11),f.kc(14,"async"),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(15,"div",12),f.Vb(16,"button",13),f.fc("click",(function(){return t.AddCus()})),f.Mc(17,"Add New Customer"),f.Ub(),f.Ub(),f.Ub()),2&e){var n=f.xc(12);f.Cb(10),f.pc("formControl",t.myControl)("matAutocomplete",n),f.Cb(3),f.pc("ngForOf",f.lc(14,3,t.filteredOptions))}},directives:[a.A,a.r,a.s,g.c,v.b,a.e,D.c,a.q,a.h,D.a,o.l,y.b,U.n],pipes:[o.b],encapsulation:2}),e}(),F=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function c(e){try{s(i.next(e))}catch(t){a(t)}}function r(e){try{s(i.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}s((i=i.apply(e,t||[])).next())}))},H=function(e,t){var n,i,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function r(a){return function(r){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,i=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){c.label=a[1];break}if(6===a[0]&&c.label<o[1]){c.label=o[1],o=a;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(a);break}o[2]&&c.ops.pop(),c.trys.pop();continue}a=t.call(e,c)}catch(r){a=[6,r],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,r])}}},K=["map"];function W(e,t){if(1&e&&(f.Vb(0,"mat-option",43),f.Mc(1),f.Ub()),2&e){var n=t.$implicit;f.pc("value",n.id),f.Cb(1),f.Oc(" ",n.name," ")}}function q(e,t){if(1&e&&(f.Vb(0,"li",44),f.Vb(1,"div",45),f.Vb(2,"i",9),f.Mc(3,"people"),f.Ub(),f.Ub(),f.Vb(4,"div",46),f.Vb(5,"div",47),f.Vb(6,"span",48),f.Mc(7,"CUSTOMER INFO"),f.Ub(),f.Ub(),f.Vb(8,"div",49),f.Vb(9,"div",15),f.Vb(10,"div",50),f.Vb(11,"div",51),f.Vb(12,"a",52),f.Qb(13,"img",53),f.Ub(),f.Ub(),f.Vb(14,"div",54),f.Vb(15,"h6",55),f.Mc(16),f.Ub(),f.Vb(17,"h4",19),f.Mc(18),f.Ub(),f.Vb(19,"p",56),f.Mc(20),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(21,"h6"),f.Qb(22,"i",57),f.Mc(23),f.Ub(),f.Ub(),f.Ub()),2&e){var n=f.jc(2);f.Cb(16),f.Oc(" ",n.selectedCustomer.email," "),f.Cb(2),f.Oc(" ",n.selectedCustomer.phone," "),f.Cb(2),f.Oc(" ",n.selectedCustomer.address," "),f.Cb(3),f.Oc(" ",n.selectedCustomer.name,"")}}function G(e,t){if(1&e&&f.Qb(0,"ticket-add-job",58),2&e){var n=f.jc(2);f.pc("cusEmail",n.selectedCustomer.email)}}var $,z=function(){return{standalone:!0}};function X(e,t){if(1&e){var n=f.Wb();f.Vb(0,"div",3),f.Vb(1,"div",4),f.Vb(2,"div",5),f.Vb(3,"ul",6),f.Vb(4,"li",7),f.Vb(5,"a",8),f.Vb(6,"i",9),f.Mc(7,"create_new_folder"),f.Ub(),f.Mc(8," New Ticket "),f.Ub(),f.Ub(),f.Vb(9,"li",7),f.Vb(10,"a",10),f.Vb(11,"i",9),f.Mc(12,"people"),f.Ub(),f.Mc(13," Customer Information "),f.Ub(),f.Ub(),f.Vb(14,"li",7),f.Vb(15,"a",11),f.Vb(16,"i",9),f.Mc(17,"work"),f.Ub(),f.Mc(18," Jobs "),f.Ub(),f.Ub(),f.Vb(19,"li",7),f.Vb(20,"a",12),f.fc("click",(function(){return f.Bc(n),f.jc().gotoSearch()})),f.Vb(21,"i",9),f.Mc(22,"search"),f.Ub(),f.Mc(23," Go to Search "),f.Ub(),f.Ub(),f.Ub(),f.Vb(24,"div",13),f.Vb(25,"div",14),f.Vb(26,"div",3),f.Vb(27,"div",15),f.Vb(28,"div",16),f.Vb(29,"div",17),f.Vb(30,"div",18),f.Vb(31,"h4",19),f.Mc(32,"New Ticket"),f.Ub(),f.Ub(),f.Ub(),f.Vb(33,"form"),f.Vb(34,"div",20),f.Vb(35,"mat-form-field"),f.Vb(36,"mat-select",21),f.fc("ngModelChange",(function(e){return f.Bc(n),f.jc()._cat=e})),f.Kc(37,W,2,2,"mat-option",22),f.Ub(),f.Ub(),f.Ub(),f.Vb(38,"div",20),f.Vb(39,"mat-form-field",23),f.Vb(40,"input",24),f.fc("ngModelChange",(function(e){return f.Bc(n),f.jc()._addr=e})),f.Ub(),f.Ub(),f.Ub(),f.Vb(41,"div",20),f.Vb(42,"mat-form-field",23),f.Vb(43,"input",25),f.fc("ngModelChange",(function(e){return f.Bc(n),f.jc().radius=e})),f.Ub(),f.Ub(),f.Ub(),f.Vb(44,"div",20),f.Vb(45,"mat-form-field",23),f.Vb(46,"textarea",26),f.fc("ngModelChange",(function(e){return f.Bc(n),f.jc()._note=e})),f.Ub(),f.Ub(),f.Ub(),f.Vb(47,"div",27),f.Vb(48,"button",28),f.fc("click",(function(){return f.Bc(n),f.jc().searchButtonClick()})),f.Mc(49),f.Ub(),f.Vb(50,"div",29),f.Qb(51,"p",30),f.Qb(52,"p",31),f.Vb(53,"button",32),f.fc("click",(function(){return f.Bc(n),f.jc().assignClicked()})),f.Mc(54," Assign "),f.Ub(),f.Qb(55,"p",33),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(56,"div",34),f.Vb(57,"div",16),f.Vb(58,"div",17),f.Vb(59,"div",18),f.Vb(60,"h4",19),f.Mc(61,"Google Map"),f.Ub(),f.Ub(),f.Ub(),f.Vb(62,"div",35),f.Qb(63,"div",36,37),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(65,"div",38),f.Vb(66,"ul",39),f.Kc(67,q,24,4,"li",40),f.Ub(),f.Ub(),f.Vb(68,"div",41),f.Kc(69,G,1,1,"ticket-add-job",42),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Ub()}if(2&e){var i=f.jc();f.Cb(36),f.pc("ngModel",i._cat),f.Cb(1),f.pc("ngForOf",i.categories),f.Cb(3),f.pc("ngModel",i._addr)("ngModelOptions",f.sc(10,z)),f.Cb(3),f.pc("ngModel",i.radius),f.Cb(3),f.pc("ngModel",i._note),f.Cb(2),f.pc("disabled",i.button_pressed),f.Cb(1),f.Oc(" ",i.button_pressed?"Please wait...":"Search"," "),f.Cb(18),f.pc("ngIf",i.selectedCustomer),f.Cb(2),f.pc("ngIf",i.selectedCustomer)}}function Y(e,t){if(1&e){var n=f.Wb();f.Vb(0,"div",34),f.Vb(1,"div",16),f.Vb(2,"div",61),f.Vb(3,"div",62),f.Vb(4,"i",9),f.Mc(5,"mail_outline"),f.Ub(),f.Ub(),f.Vb(6,"h4",19),f.Mc(7,"New Customer"),f.Ub(),f.Ub(),f.Vb(8,"div",54),f.Vb(9,"form",63),f.Vb(10,"mat-form-field",23),f.Vb(11,"input",64),f.fc("ngModelChange",(function(e){return f.Bc(n),f.jc(2)._name=e})),f.Ub(),f.Ub(),f.Vb(12,"mat-form-field",23),f.Vb(13,"input",65),f.fc("ngModelChange",(function(e){return f.Bc(n),f.jc(2)._cus_addr=e})),f.Ub(),f.Ub(),f.Vb(14,"mat-form-field",23),f.Vb(15,"input",66),f.fc("ngModelChange",(function(e){return f.Bc(n),f.jc(2)._phone=e})),f.Ub(),f.Ub(),f.Vb(16,"mat-form-field",23),f.Vb(17,"input",67),f.fc("ngModelChange",(function(e){return f.Bc(n),f.jc(2)._email=e})),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(18,"div",27),f.Vb(19,"button",28),f.fc("click",(function(){return f.Bc(n),f.jc(2).customerSubmitClicked()})),f.Mc(20),f.Ub(),f.Ub(),f.Qb(21,"br"),f.Vb(22,"div",29),f.Qb(23,"p",30),f.Qb(24,"p",31),f.Ub(),f.Ub(),f.Ub()}if(2&e){var i=f.jc(2);f.Cb(11),f.pc("ngModel",i._name),f.Cb(2),f.pc("ngModel",i._cus_addr),f.Cb(2),f.pc("ngModel",i._phone),f.Cb(2),f.pc("ngModel",i._email),f.Cb(2),f.pc("disabled",i.button_pressed),f.Cb(1),f.Oc(" ",i.button_pressed?"Please wait...":"Submit"," ")}}function Z(e,t){if(1&e){var n=f.Wb();f.Vb(0,"div",3),f.Vb(1,"div",15),f.Vb(2,"app-search-customer",59),f.fc("_onCustomerSelect",(function(e){return f.Bc(n),f.jc().onCustomerSelect(e)}))("_AddCus",(function(e){return f.Bc(n),f.jc().AddCus(e)})),f.Ub(),f.Ub(),f.Kc(3,Y,25,6,"div",60),f.Ub()}if(2&e){var i=f.jc();f.Cb(3),f.pc("ngIf",i.isAddNewCus)}}var ee,te,ne={},ie={enableHighAccuracy:!0,timeout:6e4,maximumAge:0},oe="http://maps.google.com/mapfiles/ms/icons/",ae=[{path:"",children:[{path:"",component:function(){function e(e,t){this.http=e,this.previewProgressSpinner=t,this.config=new b.a,this.service=new m.a,this.categories=[],this.technicians=[],this._cat=[],this._addr="",this.radius=10,this._note="",this.button_pressed=!1,this.isReassign=!1,this.hasURLQuery=!1,this.isAddNewCus=!1,this._name="",this._cus_addr="",this._phone="+234",this._email=""}return e.prototype.initMap=function(){var e=this;navigator.geolocation.getCurrentPosition((function(t){$=new google.maps.Map(e.mapElement.nativeElement,{center:{lat:t.coords.latitude,lng:t.coords.longitude},zoom:10}),ee=new google.maps.InfoWindow,ne.current=new google.maps.Marker({position:{lat:t.coords.latitude,lng:t.coords.longitude},map:$,title:"Click to zoom",icon:oe+"blue-dot.png"}),e.markerPan=ne.current,$.addListener("center_changed",(function(){window.setTimeout((function(){$.panTo(e.markerPan.getPosition())}),3e3)})),ne.current.addListener("click",(function(e){ee.setPosition(e.latLng),ee.setContent("Current location"),ee.open($,ne.current)}))}),(function(t){e.config.displayMessage(t.message+". Refresh this page.",!1)}),ie)},e.prototype.createMarker=function(e,t,n,i){var o=this.isReassign,a=""+i.status,c="online"===a?"block":"none";ne[n]=new google.maps.Marker({map:$,position:{lat:e,lng:t},icon:"online"===a?oe+"green-dot.png":oe+"red-dot.png"}),this.markerPan=ne[n],google.maps.event.addListener(ne[n],"click",(function(){ee.setContent('<div class="card">\n      <div class="card-header card-header-text card-header-rose">\n        <div class="card-text">\n          <h4 class="card-title">'+i.name+'</h4>\n        </div>\n        <div class="card-body">\n        <label>Email Address: <a href="mailto:'+i.email+'">'+i.email+'</a></label><br>\n        <label>Phone Number: <a href="tel:'+i.phone+'">'+i.phone+'</a></label><br>\n        <label>Address: <a href="https://google.com/maps/'+i.address+'">'+i.address+"</a></label><br>\n        <label>Status: "+i.status+'</label><br>\n        </div>\n        <div class="card-footer">\n        <button style="display: '+c+';" mat-raised-button type="button" id="'+n+'" class="btn btn-fill btn-rose btn-block">\n              '+(o?"Re-Assign":"Assign")+"\n        </button>\n        </div>\n      </div>\n      </div>"),ee.open($,ne[n]),setTimeout((function(){document.getElementById(n).addEventListener("click",(function(){document.getElementById("assign-id").innerText=n,document.getElementById("assignBtnClick").click()}))}),500)}))},e.prototype.onCustomerSelect=function(e){var t=this;this.previewProgressSpinner.open({hasBackdrop:!0},l.a);var n=e.option.value;this.isAddNewCus=!1,this.hasURLQuery=!0,this.getCustomerByEmail(n).then((function(e){t.previewProgressSpinner.close(),setTimeout((function(){t.initMap()}),2e3),setTimeout((function(){t.initAutoComplete()}),2e3)}))},e.prototype.AddCus=function(e){var t=this;this.isAddNewCus=e,setTimeout((function(){t.initAutoComplete()}),2e3)},e.prototype.customerSubmitClicked=function(){return F(this,void 0,void 0,(function(){var e,t,n,i,o,a,c,r,b,l,u,m=this;return H(this,(function(f){switch(f.label){case 0:return e=document.getElementById("cus_name").value,t=document.getElementById("cus_phone").value,n=document.getElementById("cus_email").value,i=document.getElementById("madd").innerHTML,""===e||""===t||""===i||""===n?(this.config.displayMessage("Please fill all fields and use google autocomplete for address.",!1),[2]):t.startsWith("+234")?(o=JSON.parse(document.getElementById("mgeo").innerHTML),this.button_pressed=!0,a=s.database().ref().push().key,c=localStorage.getItem("email"),r=localStorage.getItem("name"),b=d.a(s),[4,s.firestore().collection("customers").where("email","==",n).get()]):(this.config.displayMessage("Please input correct address. Must start with +234",!1),[2]);case 1:return f.sent().size>0?(this.button_pressed=!1,this.config.displayMessage("customer already exists",!1),[2]):(l=b.point(o.lat,o.lng),u={id:a,name:e,address:i,position:{geohash:l.geohash,geopoint:l.geopoint},phone:t,email:n,created_by:r+"|"+c,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()},s.firestore().collection("customers").doc(n.toLowerCase()).set(u).then((function(e){m.button_pressed=!1,m.config.logActivity(r+"|"+c+" created this customer: "+n),m.onCustomerSelect({option:{value:n}})})).catch((function(e){m.button_pressed=!1,m.config.displayMessage(""+e,!1)})),[2])}}))}))},e.prototype.gotoSearch=function(){this.hasURLQuery=!1},e.prototype.ngOnInit=function(){var e=this;if(""!==location.search){this.hasURLQuery=!0;var t=this.config.getUrlParameter("customer"),n=this.config.getUrlParameter("jobid");this.getCustomerByEmail(t),void 0!==n&&(this.isReassign=!0,this.getJobDataById(n)),setTimeout((function(){e.initMap()}),2e3),setTimeout((function(){e.initAutoComplete()}),2e3)}this.getCategories();var i=localStorage.getItem("email");this.service.getUserData(i).then((function(t){e.currentUser=t}))},e.prototype.getCustomerByEmail=function(e){return F(this,void 0,void 0,(function(){var t,n=this;return H(this,(function(i){switch(i.label){case 0:return[4,s.firestore().collection("customers").doc(e.toLowerCase()).get()];case 1:return(t=i.sent()).exists?(this.selectedCustomer=t.data(),this._addr=this.selectedCustomer.address,setTimeout((function(){document.getElementById("madd").innerHTML=n.selectedCustomer.address,document.getElementById("mgeo").innerHTML=JSON.stringify(n.selectedCustomer.position.geopoint)}),3e3),[2]):(this.config.displayMessage("Invalid customer.",!1),setTimeout((function(){location.href="/customer"}),2e3),[2])}}))}))},e.prototype.getJobDataById=function(e){return F(this,void 0,void 0,(function(){var t;return H(this,(function(n){switch(n.label){case 0:return[4,s.firestore().collection("jobs").doc(e).get()];case 1:return(t=n.sent()).exists?(this.selectedJob=t.data(),this._cat=this.selectedJob.category,this._note=this.selectedJob.note,[2]):(this.config.displayMessage("Invalid job ID.",!1),setTimeout((function(){location.href="/customer"}),2e3),[2])}}))}))},e.prototype.getCategories=function(){var e=this;s.firestore().collection("categories").orderBy("name","asc").get().then((function(t){e.categories=[],t.forEach((function(t){var n=t.data();e.categories.push(n)}))}))},e.prototype.initAutoComplete=function(){var e=this.isAddNewCus?document.getElementById("cus_addr"):document.getElementById("formGroupExampleInput2"),t=new google.maps.places.Autocomplete(e);t.setFields(["address_components","geometry","icon","name"]),t.addListener("place_changed",(function(){var e=t.getPlace();e.geometry||window.alert("No details available for input: '"+e.name+"'"),document.getElementById("mgeo").innerHTML=JSON.stringify(e.geometry.location.toJSON());var n="";e.address_components&&(n=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "),document.getElementById("madd").innerHTML=n)}))},e.prototype.searchButtonClick=function(){var e=document.getElementById("madd").innerHTML;0!==this._cat.length&&""!==e&&0!==this.radius&&null!==this.radius?this.searchForTechnicians():this.config.displayMessage("please fill all fields with *",!1)},e.prototype.searchForTechnicians=function(){return F(this,void 0,void 0,(function(){var e,t,n,i,o=this;return H(this,(function(a){return this.button_pressed=!0,e=d.a(s),t=s.firestore().collection("users").where("user_type","==","technician").where("category","array-contains-any",this._cat).where("blocked","==",!1),n=JSON.parse(document.getElementById("mgeo").innerHTML),i=void 0===n.lat?e.point(n.latitude,n.longitude):e.point(n.lat,n.lng),e.query(t).within(i,this.radius,"position").subscribe((function(e){o.button_pressed=!1,0!==e.length?(o.technicians=[],e.forEach((function(e){o.technicians.push(e);var t=e.position.geopoint;o.createMarker(t.latitude,t.longitude,e.id,e)}))):o.config.displayMessage("No technicians found. Try again!",!1)})),[2]}))}))},e.prototype.assignClicked=function(){var e=this;this.previewProgressSpinner.open({hasBackdrop:!0},l.a);var t=document.getElementById("assign-id").innerText,n=this.technicians.find((function(e,n,i){return e.id===t})),i={name:n.name,blocked:n.blocked,address:n.address,position:n.position,phone:n.phone,email:n.email,category:n.category,status:n.status},o=localStorage.getItem("email"),a=localStorage.getItem("name"),c=s.database().ref().push().key;if(this.isReassign)r={customer:this.selectedCustomer,assigned_to:i,agent:this.currentUser,status:"Pending",back_end_status:"active",category:this._cat,note:this._note,modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString()},s.firestore().collection("jobs").doc(this.selectedJob.id).update(r).then((function(t){var c=s.database().ref().push().key,r={id:c,comment:"This job was updated for : "+e.selectedCustomer.name+" and reassigned to "+i.name,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()};s.firestore().collection("jobs").doc(e.selectedJob.id).collection("activities").doc(c).set(r).then((function(t){e.previewProgressSpinner.close(),e.config.logActivity(a+"|"+o+" updated this job for : "+e.selectedCustomer.name+" and reassigned to "+i.name),e.sendSMS(n.name,n.phone,n.msgID),e.config.displayMessage("Successfully created",!0)})).catch((function(t){e.previewProgressSpinner.close(),e.config.displayMessage(""+t,!1)}))})).catch((function(t){e.previewProgressSpinner.close(),e.config.displayMessage(""+t,!1)}));else{var r={id:c,job_id:this.config.randomInt(0,9999999999),customer:this.selectedCustomer,assigned_to:i,agent:this.currentUser,status:"Pending",back_end_status:"active",category:this._cat,note:this._note,created_by:a+"|"+o,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()};s.firestore().collection("jobs").doc(c).set(r).then((function(t){var r=s.database().ref().push().key,d={id:r,comment:"This job was created for : "+e.selectedCustomer.name+" and assigned to "+i.name,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()};s.firestore().collection("jobs").doc(c).collection("activities").doc(r).set(d).then((function(t){e.previewProgressSpinner.close(),e.config.logActivity(a+"|"+o+" created this job for : "+e.selectedCustomer.name+" and assigned to "+i.name),e.sendSMS(n.name,n.phone,n.msgID),e.config.displayMessage("Successfully created",!0),setTimeout((function(){location.href="/jobs"}),2e3)})).catch((function(t){e.previewProgressSpinner.close(),e.config.displayMessage(""+t,!1)}))})).catch((function(t){e.previewProgressSpinner.close(),e.config.displayMessage(""+t,!1)}))}},e.prototype.sendSMS=function(e,t,n){var i="A technician will be with you shortly. \nName: "+e+"\nPhone: "+t;this.config.sendSMS(this.http,t,"You have been assigned a job. Please login to Pronto to accept the job and to view customer details.",n.join(","),"notification"),this.config.sendSMS(this.http,this.selectedCustomer.phone,i,"","sms")},e.\u0275fac=function(t){return new(t||e)(f.Pb(p.a),f.Pb(u.b))},e.\u0275cmp=f.Jb({type:e,selectors:[["app-new-ticket"]],viewQuery:function(e,t){var n;1&e&&f.Qc(K,!0),2&e&&f.wc(n=f.gc())&&(t.mapElement=n.first)},decls:4,vars:2,consts:[[1,"main-content"],[1,"container-fluid"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-12","ml-auto","mr-auto"],[1,"page-categories"],["role","tablist",1,"nav","nav-pills","nav-pills-warning","nav-pills-icons","justify-content-center"],[1,"nav-item"],["data-toggle","tab","href","#link7","role","tablist",1,"nav-link","active"],[1,"material-icons"],["data-toggle","tab","href","#link8","role","tablist",1,"nav-link"],["data-toggle","tab","href","#link9","role","tablist",1,"nav-link"],["data-toggle","tab","href","javascript:void(0)","role","tablist",1,"nav-link",3,"click"],[1,"tab-content","tab-space","tab-subcategories"],["id","link7",1,"tab-pane","active"],[1,"col-md-4"],[1,"card"],[1,"card-header","card-header-text","card-header-rose"],[1,"card-text"],[1,"card-title"],[1,"form-group","mx-sm-3","mb-2"],["multiple","","placeholder","Category*","name","plumber","ariaLabel","Techies[0]","id","tech_cat",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"example-full-width"],["matInput","","type","address","id","formGroupExampleInput2","placeholder","Address*",1,"form-control",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","placeholder","Radius in Km*","name","mRadius","type","number","id","tech_rad",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder","Additional Comment","name","nt","id","idnt",1,"form-control",3,"ngModel","ngModelChange"],[1,"card-footer"],["mat-raised-button","","type","submit",1,"btn","btn-fill","btn-rose","btn-block",3,"disabled","click"],[2,"display","none"],["id","madd"],["id","mgeo"],["mat-raised-button","","type","submit","id","assignBtnClick",1,"btn","btn-fill","btn-rose","btn-block",3,"click"],["id","assign-id"],[1,"col-md-8"],[1,"card-content"],["id","map",1,"mapSize"],["map",""],["id","link8",1,"tab-pane"],[1,"timeline","timeline-simple"],["class","timeline-inverted",4,"ngIf"],["id","link9",1,"tab-pane"],[3,"cusEmail",4,"ngIf"],[3,"value"],[1,"timeline-inverted"],[1,"timeline-badge","danger"],[1,"timeline-panel"],[1,"timeline-heading"],[1,"badge","badge-danger"],[1,"timeline-body"],[1,"card","card-profile"],[1,"card-avatar"],["href","javascript:void(0)"],["src","assets/img/default-avatar.png",1,"img"],[1,"card-body"],[1,"card-category","text-gray"],[1,"card-description"],[1,"ti-time"],[3,"cusEmail"],[3,"_onCustomerSelect","_AddCus"],["class","col-md-8",4,"ngIf"],[1,"card-header","card-header-rose","card-header-icon"],[1,"card-icon"],["method","#","action","#"],["matInput","","placeholder","Name","name","mMame","type","text","id","cus_name",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder"," Address","type","address","autocomplete","off","name","mAddr","id","cus_addr",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder","Phone Number","name","mPhone","type","tel","id","cus_phone",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","name","memail","placeholder","Email","type","email","id","cus_email",1,"form-control",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(f.Vb(0,"div",0),f.Vb(1,"div",1),f.Kc(2,X,70,11,"div",2),f.Kc(3,Z,4,1,"div",2),f.Ub(),f.Ub()),2&e&&(f.Cb(2),f.pc("ngIf",t.hasURLQuery),f.Cb(1),f.pc("ngIf",!t.hasURLQuery))},directives:[o.m,a.A,a.r,a.s,g.c,h.a,a.q,a.t,o.l,v.b,a.e,a.v,y.b,U.n,L,Q],styles:[".mapSize[_ngcontent-%COMP%]{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}"]}),e}()}]}],ce=n("Ji7U"),re=n("LK+K"),se=(n("ODXe"),n("KQm4"),n("o0o1"),n("vuIU")),de=n("1OyB"),be=(n("mrSG"),n("HDdC"),n("2Vo4"),n("Cfvw"),n("PqYM"),n("XNiG"),n("04ZW"),n("VRyK"),n("jtHE"),n("QqCr"),n("LRne"),n("z6cu"),n("5+tZ"),n("c6ID"),n("eIep"),n("UXun"),n("/uUt"),n("1G5W"),n("zP0r"),n("oB13"),function(){var e=function e(){Object(de.a)(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=f.Lb({token:e,factory:function(t){return e.\u0275fac(t)}}),e}()),le=function(){function e(){Object(de.a)(this,e)}return Object(se.a)(e,[{key:"getNativeWindow",value:function(){return window}}]),e}(),ue=function(){function e(){Object(de.a)(this,e)}return Object(se.a)(e,[{key:"getNativeDocument",value:function(){return document}}]),e}(),me=[le,ue],fe=function(e){return e[e.HTTP=1]="HTTP",e[e.HTTPS=2]="HTTPS",e[e.AUTO=3]="AUTO",e}({}),pe=new f.s("angular-google-maps LAZY_MAPS_API_CONFIG"),ge=function(){var e=function(e){Object(ce.a)(n,e);var t=Object(re.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,c=arguments.length>3?arguments[3]:void 0;return Object(de.a)(this,n),(e=t.call(this)).localeId=c,e._SCRIPT_ID="agmGoogleMapsApiScript",e.callbackName="agmLazyMapsAPILoader",e._config=i||{},e._windowRef=o,e._documentRef=a,e}return Object(se.a)(n,[{key:"load",value:function(){var e=this._windowRef.getNativeWindow();if(e.google&&e.google.maps)return Promise.resolve();if(this._scriptLoadingPromise)return this._scriptLoadingPromise;var t=this._documentRef.getNativeDocument().getElementById(this._SCRIPT_ID);if(t)return this._assignScriptLoadingPromise(t),this._scriptLoadingPromise;var n=this._documentRef.getNativeDocument().createElement("script");return n.type="text/javascript",n.async=!0,n.defer=!0,n.id=this._SCRIPT_ID,n.src=this._getScriptSrc(this.callbackName),this._assignScriptLoadingPromise(n),this._documentRef.getNativeDocument().body.appendChild(n),this._scriptLoadingPromise}},{key:"_assignScriptLoadingPromise",value:function(e){var t=this;this._scriptLoadingPromise=new Promise((function(n,i){t._windowRef.getNativeWindow()[t.callbackName]=function(){n()},e.onerror=function(e){i(e)}}))}},{key:"_getScriptSrc",value:function(e){var t;switch(this._config&&this._config.protocol||fe.HTTPS){case fe.AUTO:t="";break;case fe.HTTP:t="http:";break;case fe.HTTPS:t="https:"}var n=this._config.hostAndPath||"maps.googleapis.com/maps/api/js",i={v:this._config.apiVersion||"quarterly",callback:e,key:this._config.apiKey,client:this._config.clientId,channel:this._config.channel,libraries:this._config.libraries,region:this._config.region,language:this._config.language||"en-US"!==this.localeId?this.localeId:null},o=Object.keys(i).filter((function(e){return null!=i[e]})).filter((function(e){return!Array.isArray(i[e])||Array.isArray(i[e])&&i[e].length>0})).map((function(e){var t=i[e];return Array.isArray(t)?{key:e,value:t.join(",")}:{key:e,value:i[e]}})).map((function(e){return"".concat(e.key,"=").concat(e.value)})).join("&");return"".concat(t,"//").concat(n,"?").concat(o)}}]),n}(be);return e.\u0275fac=function(t){return new(t||e)(f.dc(pe,8),f.dc(le),f.dc(ue),f.dc(f.w))},e.\u0275prov=f.Lb({token:e,factory:function(t){return e.\u0275fac(t)}}),e}(),he=function(){var e=te=function(){function e(){Object(de.a)(this,e)}return Object(se.a)(e,null,[{key:"forRoot",value:function(e){return{ngModule:te,providers:[].concat(me,[{provide:be,useClass:ge},{provide:pe,useValue:e}])}}}]),e}();return e.\u0275mod=f.Nb({type:e}),e.\u0275inj=f.Mb({factory:function(t){return new(t||e)}}),e}(),ve=function(){function e(){}return e.\u0275mod=f.Nb({type:e}),e.\u0275inj=f.Mb({factory:function(t){return new(t||e)},imports:[[o.c,i.g.forChild(ae),a.l,a.x,c.a,r.b,M.b,he.forRoot({apiKey:"YOUR-API-KEY-HERE",libraries:["places"]})]]}),e}()}}]);