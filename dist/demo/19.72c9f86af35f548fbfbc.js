(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"5I2P":function(e,t,n){"use strict";n.r(t),n.d(t,"CustomerModule",(function(){return U}));var o=n("tyNb"),a=n("ofXK"),i=n("3Pt+"),c=n("OsiS"),r=n("ZAI4"),s=n("Wcq6"),d=n("x4++"),l=(n("5x/H"),n("Zs65"),n("EVdn")),b=(n("FlOX"),n("e1J8"),n("4WDQ")),u=n("PSD3"),m=n.n(u),f=n("P9ut"),h=n("fXoL"),p=n("bTqV"),g=n("kmnG"),C=n("qFsG");function y(e,t){if(1&e){var n=h.Wb();h.Vb(0,"a",21),h.fc("click",(function(){h.Bc(n);var e=h.jc().$implicit;return h.jc(2).deleteCusClick(e[0],e[4])})),h.Vb(1,"i",8),h.Mc(2,"close"),h.Ub(),h.Ub()}}function v(e,t){if(1&e){var n=h.Wb();h.Vb(0,"tr"),h.Vb(1,"td"),h.Mc(2),h.Ub(),h.Vb(3,"td"),h.Mc(4),h.Ub(),h.Vb(5,"td"),h.Mc(6),h.Ub(),h.Vb(7,"td"),h.Mc(8),h.Ub(),h.Vb(9,"td"),h.Mc(10),h.Ub(),h.Vb(11,"td"),h.Mc(12),h.Ub(),h.Vb(13,"td",16),h.Vb(14,"a",18),h.fc("click",(function(){h.Bc(n);var e=t.$implicit;return h.jc(2).ticketCusClick(e[4])})),h.Vb(15,"i",8),h.Mc(16,"create_new_folder"),h.Ub(),h.Ub(),h.Vb(17,"a",19),h.fc("click",(function(){h.Bc(n);var e=t.$implicit;return h.jc(2).editCusClick(e[0])})),h.Vb(18,"i",8),h.Mc(19,"edit"),h.Ub(),h.Ub(),h.Kc(20,y,3,0,"a",20),h.Ub(),h.Ub()}if(2&e){var o=t.$implicit,a=h.jc(2);h.Cb(2),h.Nc(o[1]),h.Cb(2),h.Nc(o[2]),h.Cb(2),h.Nc(o[3]),h.Cb(2),h.Nc(o[4]),h.Cb(2),h.Nc(o[5]),h.Cb(2),h.Nc(o[6]),h.Cb(8),h.pc("ngIf","Administrator"===a.role||"SubAdmin"===a.role)}}function w(e,t){if(1&e){var n=h.Wb();h.Vb(0,"div",3),h.Vb(1,"div",4),h.Vb(2,"div",5),h.Vb(3,"div",6),h.Vb(4,"div",7),h.Vb(5,"i",8),h.Mc(6,"assignment"),h.Ub(),h.Ub(),h.Vb(7,"h4",9),h.Mc(8,"My Customers"),h.Ub(),h.Vb(9,"button",10),h.fc("click",(function(){return h.Bc(n),h.jc().addCus()})),h.Mc(10," Add New Customer "),h.Ub(),h.Ub(),h.Vb(11,"div",11),h.Qb(12,"div",12),h.Vb(13,"div",13),h.Vb(14,"table",14),h.Vb(15,"thead"),h.Vb(16,"tr"),h.Vb(17,"th"),h.Mc(18),h.Ub(),h.Vb(19,"th"),h.Mc(20),h.Ub(),h.Vb(21,"th"),h.Mc(22),h.Ub(),h.Vb(23,"th"),h.Mc(24),h.Ub(),h.Vb(25,"th"),h.Mc(26),h.Ub(),h.Vb(27,"th"),h.Mc(28),h.Ub(),h.Vb(29,"th",15),h.Mc(30),h.Ub(),h.Ub(),h.Ub(),h.Vb(31,"tfoot"),h.Vb(32,"tr"),h.Vb(33,"th"),h.Mc(34),h.Ub(),h.Vb(35,"th"),h.Mc(36),h.Ub(),h.Vb(37,"th"),h.Mc(38),h.Ub(),h.Vb(39,"th"),h.Mc(40),h.Ub(),h.Vb(41,"th"),h.Mc(42),h.Ub(),h.Vb(43,"th"),h.Mc(44),h.Ub(),h.Vb(45,"th",16),h.Mc(46),h.Ub(),h.Ub(),h.Ub(),h.Vb(47,"tbody"),h.Kc(48,v,21,7,"tr",17),h.Ub(),h.Ub(),h.Ub(),h.Ub(),h.Ub(),h.Ub(),h.Ub()}if(2&e){var o=h.jc();h.Cb(18),h.Nc(o.dataTable.headerRow[0]),h.Cb(2),h.Nc(o.dataTable.headerRow[1]),h.Cb(2),h.Nc(o.dataTable.headerRow[2]),h.Cb(2),h.Nc(o.dataTable.headerRow[3]),h.Cb(2),h.Nc(o.dataTable.headerRow[4]),h.Cb(2),h.Nc(o.dataTable.headerRow[5]),h.Cb(2),h.Oc(" ",o.dataTable.headerRow[6]," "),h.Cb(4),h.Nc(o.dataTable.footerRow[0]),h.Cb(2),h.Nc(o.dataTable.footerRow[1]),h.Cb(2),h.Nc(o.dataTable.footerRow[2]),h.Cb(2),h.Nc(o.dataTable.footerRow[3]),h.Cb(2),h.Nc(o.dataTable.footerRow[4]),h.Cb(2),h.Nc(o.dataTable.headerRow[5]),h.Cb(2),h.Nc(o.dataTable.footerRow[6]),h.Cb(2),h.pc("ngForOf",o.dataTable.dataRows)}}function V(e,t){if(1&e){var n=h.Wb();h.Vb(0,"div",3),h.Vb(1,"div",22),h.Vb(2,"div",5),h.Vb(3,"div",23),h.Vb(4,"div",7),h.Vb(5,"i",8),h.Mc(6,"mail_outline"),h.Ub(),h.Ub(),h.Vb(7,"h4",9),h.Mc(8,"New Customers"),h.Ub(),h.Ub(),h.Vb(9,"div",11),h.Vb(10,"form",24),h.Vb(11,"mat-form-field",25),h.Vb(12,"input",26),h.fc("ngModelChange",(function(e){return h.Bc(n),h.jc()._name=e})),h.Ub(),h.Ub(),h.Vb(13,"mat-form-field",25),h.Vb(14,"input",27),h.fc("ngModelChange",(function(e){return h.Bc(n),h.jc()._addr=e})),h.Ub(),h.Ub(),h.Vb(15,"mat-form-field",25),h.Vb(16,"input",28),h.fc("ngModelChange",(function(e){return h.Bc(n),h.jc()._phone=e})),h.Ub(),h.Ub(),h.Vb(17,"mat-form-field",25),h.Vb(18,"input",29),h.fc("ngModelChange",(function(e){return h.Bc(n),h.jc()._email=e})),h.Ub(),h.Ub(),h.Ub(),h.Ub(),h.Vb(19,"div",30),h.Vb(20,"button",31),h.fc("click",(function(){return h.Bc(n),h.jc().customerSubmitClicked()})),h.Mc(21),h.Ub(),h.Vb(22,"button",32),h.fc("click",(function(){return h.Bc(n),h.jc().cancelAddCus()})),h.Mc(23," Cancel "),h.Ub(),h.Ub(),h.Qb(24,"br"),h.Vb(25,"div",33),h.Qb(26,"p",34),h.Qb(27,"p",35),h.Ub(),h.Ub(),h.Ub(),h.Ub()}if(2&e){var o=h.jc();h.Cb(12),h.pc("ngModel",o._name),h.Cb(2),h.pc("ngModel",o._addr),h.Cb(2),h.pc("ngModel",o._phone),h.Cb(2),h.pc("ngModel",o._email),h.Cb(2),h.pc("disabled",o.button_pressed),h.Cb(1),h.Oc(" ",o.button_pressed?"Please wait...":"Submit"," ")}}var M=[{path:"",children:[{path:"",component:function(){function e(){this.data=[],this.customers=[],this.addNewCus=!1,this.editCus=!1,this.config=new b.a,this.button_pressed=!1,this.service=new f.a,this.role="",this._name="",this._addr="",this._phone="+234",this._email=""}return e.prototype.initAutoComplete=function(){var e=document.getElementById("cus_addr"),t=new google.maps.places.Autocomplete(e);t.setFields(["address_components","geometry","icon","name"]),t.addListener("place_changed",(function(){var e=t.getPlace();e.geometry||window.alert("No details available for input: '"+e.name+"'"),document.getElementById("mgeo").innerHTML=JSON.stringify(e.geometry.location.toJSON());var n="";e.address_components&&(n=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "),document.getElementById("madd").innerHTML=n)}))},e.prototype.getCustomers=function(){var e=this;s.firestore().collection("customers").orderBy("timestamp","desc").onSnapshot((function(t){e.data=[],e.customers=[],t.forEach((function(t){var n=t.data();e.customers.push(n),e.data.push([n.id,n.name,n.address,n.phone,n.email,n.created_date,n.modified_date,n.created_by,"btn-link"])})),e.dataTable={headerRow:["Name","Address","Phone Number","Email","Created Date","Modified Date","Actions"],footerRow:["Name","Address","Phone Number","Email","Created Date","Modified Date","Actions"],dataRows:e.data}}))},e.prototype.ngOnInit=function(){var e=this,t=localStorage.getItem("email");this.service.getUserData(t).then((function(t){e.role=t.role,e.getCustomers()}))},e.prototype.addCus=function(){var e=this;this.addNewCus=!0,this.editCus=!1,setTimeout((function(){e.initAutoComplete()}),3e3)},e.prototype.cancelAddCus=function(){this.addNewCus=!1,this.editCus=!1,this.button_pressed=!1,this._name="",this._addr="",this._phone="+234",this._email=""},e.prototype.deleteCusClick=function(e,t){var n=this;m()({title:"Delete Alert",text:"Are you sure about deleting this customer?",type:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1}).then((function(o){o.value?s.firestore().collection("customers").doc(e).delete().then((function(e){var o=localStorage.getItem("email"),a=localStorage.getItem("name");n.config.logActivity(a+"|"+o+" deleted this customer: "+t),n.config.displayMessage("Successfully deleted",!0)})).catch((function(e){n.config.displayMessage(""+e,!1)})):m()({title:"Cancelled",text:"Deletion not successful",type:"error",confirmButtonClass:"btn btn-info",buttonsStyling:!1}).catch(m.a.noop)}))},e.prototype.editCusClick=function(e){var t=this;this.editCus=!0,this.addNewCus=!0,this.selectedCustomer=this.customers.find((function(t,n,o){return t.id===e})),this._name=this.selectedCustomer.name,this._addr=this.selectedCustomer.address,this._phone=this.selectedCustomer.phone,this._email=this.selectedCustomer.email,setTimeout((function(){document.getElementById("madd").innerHTML=t.selectedCustomer.address,document.getElementById("mgeo").innerHTML=JSON.stringify(t.selectedCustomer.position.geopoint),t.initAutoComplete()}),3e3)},e.prototype.ticketCusClick=function(e){location.href="/new-ticket?customer="+e},e.prototype.customerSubmitClicked=function(){return e=this,void 0,n=function(){var e,t,n,o,a,i,c,r,l,b,u,m=this;return function(e,t){var n,o,a,i,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(a=2&i[0]?o.return:i[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((a=(a=c.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){c.label=i[1];break}if(6===i[0]&&c.label<a[1]){c.label=a[1],a=i;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(i);break}a[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(r){i=[6,r],o=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}}(this,(function(f){switch(f.label){case 0:return e=document.getElementById("cus_name").value,t=document.getElementById("cus_phone").value,n=document.getElementById("cus_email").value,o=document.getElementById("madd").innerHTML,""===e||""===t||""===o||""===n?(this.config.displayMessage("Please fill all fields and use google autocomplete for address.",!1),[2]):t.startsWith("+234")?(a=JSON.parse(document.getElementById("mgeo").innerHTML),this.button_pressed=!0,i=s.database().ref().push().key,c=localStorage.getItem("email"),r=localStorage.getItem("name"),l=d.a(s),this.editCus?[3,2]:[4,s.firestore().collection("customers").where("email","==",n).get()]):(this.config.displayMessage("Please input correct address. Must start with +234",!1),[2]);case 1:return f.sent().size>0?(this.button_pressed=!1,this.config.displayMessage("customer already exists",!1),[2]):(b=l.point(a.lat,a.lng),u={id:i,name:e,address:o,position:{geohash:b.geohash,geopoint:b.geopoint},msgID:[],phone:t,email:n,created_by:r+"|"+c,created_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString(),timestamp:s.firestore.FieldValue.serverTimestamp()},s.firestore().collection("customers").doc(n.toLowerCase()).set(u).then((function(e){m.config.logActivity(r+"|"+c+" created this customer: "+n),m.cancelAddCus(),m.config.displayMessage("Successfully created",!0)})).catch((function(e){m.button_pressed=!1,m.config.displayMessage(""+e,!1)})),[3,3]);case 2:b=void 0===a.lat?l.point(a.latitude,a.longitude):l.point(a.lat,a.lng),u={name:e,address:o,position:{geohash:b.geohash,geopoint:b.geopoint},phone:t,email:n,modified_date:(new Date).toLocaleDateString()+" - "+(new Date).toLocaleTimeString()},s.firestore().collection("customers").doc(this.selectedCustomer.email).update(u).then((function(e){m.config.logActivity(r+"|"+c+" updated this customer: "+n),m.cancelAddCus(),m.config.displayMessage("Successfully updated",!0)})).catch((function(e){m.button_pressed=!1,m.config.displayMessage(""+e,!1)})),f.label=3;case 3:return[2]}}))},new((t=void 0)||(t=Promise))((function(o,a){function i(e){try{r(n.next(e))}catch(t){a(t)}}function c(e){try{r(n.throw(e))}catch(t){a(t)}}function r(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,c)}r((n=n.apply(e,[])).next())}));var e,t,n},e.prototype.ngAfterViewInit=function(){l("#datatables").DataTable({pagingType:"full_numbers",lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],responsive:!0,language:{search:"_INPUT_",searchPlaceholder:"Search records"}}),l("#datatables").DataTable(),l(".card .material-datatables label").addClass("form-group")},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=h.Jb({type:e,selectors:[["app-customer"]],decls:4,vars:2,consts:[[1,"main-content"],[1,"container-fluid"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-primary","card-header-icon"],[1,"card-icon"],[1,"material-icons"],[1,"card-title"],["mat-raised-button","",1,"btn","btn-primary",3,"click"],[1,"card-body"],[1,"toolbar"],[1,"material-datatables"],["id","datatables","cellspacing","0","width","100%",1,"table","table-striped","table-no-bordered","table-hover",2,"width","100%"],[1,"disabled-sorting","text-right"],[1,"text-right"],[4,"ngFor","ngForOf"],["href","javascript:void(0)","data-toggle","tooltip","title","new ticket","data-placement","bottom",1,"btn","btn-link","btn-warning","btn-just-icon","create_new_folder",3,"click"],["href","javascript:void(0)","data-toggle","tooltip","title","edit","data-placement","bottom",1,"btn","btn-link","btn-warning","btn-just-icon","edit",3,"click"],["href","javascript:void(0)","data-toggle","tooltip","title","delete","data-placement","bottom","class","btn btn-link btn-danger btn-just-icon remove",3,"click",4,"ngIf"],["href","javascript:void(0)","data-toggle","tooltip","title","delete","data-placement","bottom",1,"btn","btn-link","btn-danger","btn-just-icon","remove",3,"click"],[1,"col-md-10","offset-md-1"],[1,"card-header","card-header-rose","card-header-icon"],["method","#","action","#"],[1,"example-full-width"],["matInput","","placeholder","Name","name","mMame","type","text","id","cus_name",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder"," Address","type","address","autocomplete","off","name","mAddr","id","cus_addr",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","placeholder","Phone Number","name","mPhone","type","tel","id","cus_phone",1,"form-control",3,"ngModel","ngModelChange"],["matInput","","name","memail","placeholder","Email","type","email","id","cus_email",1,"form-control",3,"ngModel","ngModelChange"],[1,"card-footer"],["mat-raised-button","","type","submit",1,"btn","btn-fill","btn-rose","btn-block",3,"disabled","click"],["mat-raised-button","","type","submit",1,"btn","btn-fill","btn-block","btn-danger",3,"click"],[2,"display","none"],["id","madd"],["id","mgeo"]],template:function(e,t){1&e&&(h.Vb(0,"div",0),h.Vb(1,"div",1),h.Kc(2,w,49,15,"div",2),h.Kc(3,V,28,6,"div",2),h.Ub(),h.Ub()),2&e&&(h.Cb(2),h.pc("ngIf",!t.addNewCus),h.Cb(1),h.pc("ngIf",t.addNewCus))},directives:[a.m,p.b,a.l,i.A,i.r,i.s,g.c,C.b,i.e,i.q,i.t],styles:[""]}),e}()}]}],U=function(){function e(){}return e.\u0275mod=h.Nb({type:e}),e.\u0275inj=h.Mb({factory:function(t){return new(t||e)},imports:[[a.c,o.g.forChild(M),i.l,c.a,r.b]]}),e}()}}]);